# Виджет финансовых операций клиента

Проект написан на Python, в нем реализуются функции маскировки номеров банковских карт и счетов, генерирования номеров 
банковских карт в заданном диапазоне чисел, предоставляет 
возможность фильтрации данных о финансовых операциях клиента по различным параметрам.

## Структура проекта.

Проект состоит из следующих модулей:
1. main.py
   
    Осуществляет взаимодействие с пользователем, получая от него исходные данные для анализа информации о банковских
    операциях.
    Реализует следующие возможности:
    - чтение данных о банковских операциях из различных источников (JSON, CSV или Excel-файла);
    - фильтрацию данных по статусу операции (EXECUTED, CANCELED, PENDING);
    - фильтрацию данных по дате выполнения операции, а также по возрастанию или убыванию даты;
    - фильтрацию данных по коду валюты (RUB, USD, EUR и др.);
    - фильтрацию данных по ключевому слову в описании операции (перевод, открытие вклада и т.д.).
    Выводит итоговую информацию в следующем формате:

   08.12.2019 Открытие вклада

   Счет **4321
   
   Сумма: 40542 руб.

   12.11.2019 Перевод с карты на карту

   MasterCard 7771 27** **** 3727 -> Visa Platinum 1293 38** **** 9203

   Сумма: 130 USD

2. masks.py

   Содержит функции для маскировки номеров банковской карты и счета. 
   Возвращает замаскированные номера карты и счета.
   
3. widget.py

   Содержит функцию, которая принимает данные с типом и номером банковской карты или счета, 
   и возвращает маску номера карты или счета. Использует разные типы маскировки для карт и счетов.
   Например, номер карты "Visa Platinum 8990922113665229" представит в виде маски "Visa Platinum 8990 92** **** 5229",
   а номер счета "Счет 74489636417521191160" - в виде маски "Счет **1160".
   Содержит функцию, которая приводит дату в формате ISO 8601 и приводит ее к виду "ДД.ММ.ГГГГ". 
   Например, дату "2024-03-11T02:26:18.671407" приведет к виду "11-03-2024".

4. processing.py

   Содержит функции, которые принимают данные о финансовых операциях клиента и параметры для их 
   фильтрации по дате, статусу исполнения и ключевым словам из описания операций, а также делает выборку операций по
   названиям заданных категорий.
   Возвращают отфильтрованные по заданным значениям данные.

5. generators.py

   Содержит функции, которые принимают данные о финансовых операциях клиента и параметры для их 
   фильтрации по коду валюты, возвращают отфильтрованные по заданным значениям данные, генерируют номера 
   банковских карт в заданном диапазоне чисел (от 0000 0000 0000 0001 до 9999 9999 9999 9999). 
   Например, введя диапазон чисел от 1 до 99999999999, получим список номеров карт в диапазоне от 0000 0000 0000 0001 
   до 0000 0999 9999 9999.

6. decorators.py

   Содержит декоратор, который автоматически регистрирует следующие детали выполнения декорируемых функций: 
   имя функции, время и дату вызова, результат выполнения, а в случае возникновения ошибок при ее работе - 
   дополнительно передаваемые аргументы и информацию об ошибках.
   Декоратор имеет необязательный входной параметр 'filename' - имя файла, в который вносится информация
   о работе функции. Если при вызове декоратора параметр 'filename' не указан, логирование выводится в консоль.
   Файл с логами по умолчанию находится в папке 'logs'.

7. utils.py

   Содержит функцию для чтения данных о финансовых транзакциях из JSON-файла.
   Принимает на вход путь до JSON-файла и возвращает список словарей с данными о финансовых транзакциях.
   Если файл пустой, содержит не-список или не найден, функция возвращает пустой список.

8. external_api.py

   Содержит функцию для расчета суммы транзакции. 
   Принимает на вход словарь с описанием транзакции и возвращает сумму транзакции в рублях.
   Если транзакция была в USD или EUR, происходит обращение к внешнему API (Exchange Rates Data API от APILayer)
   для получения текущего курса валют и конвертации суммы операции в рубли.

9. get_data_from_file.py
   
   Содержит функции для чтения данных о транзакциях из CSV и Excel файлов. Принимают путь к файлу в виде строки,
   возвращают список словарей с транзакциями.


  
## Проверка кода.

В проекте выполнены проверки линтерами:
- Flake8: для проверки стиля кода;
- mypy: для статической типизации;
- black: для автоматического форматирования кода;
- isort: для сортировки импортов.

## Установка.

1. Клонируйте репозиторий:
```
git clone https://github.com/SergejGorshkov/Widget.git
```
2. Установите зависимости:
```
pip install -r requirements.txt
```
3. Для хранения конфиденциальных данных (ключей API, паролей и т.д.) создайте файл 
'.env' из копии файла '.env.example', поместите его в корневую директорию проекта
и замените значения переменных реальными данными. 
Обязательно добавьте файл '.env' в .gitignore.

## Тестирование.

Проект покрыт тестами `pytest` на 90%. 
Для их запуска и формирования отчета выполните команду: 
```
pytest --cov=src --cov-report=html
```
Отчет будет сгенерирован в папке htmlcov и храниться в файле с названием 
index.html.


